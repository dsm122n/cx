<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.6.347/pdf.min.js"></script>
    <link rel="icon" type="image/png" href="icon.png">
    <title>ingreso</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
      }

      textarea {
        max-width: 400px; /* Set your desired maximum width */
        height: auto;
        min-height: 150px; /* Set a minimum height if needed */
        padding: 10px;
        box-sizing: border-box;
        resize: vertical; /* Allow vertical resizing */
      }
    </style>
    <script src="lab.js"></script>
  </head>
  <body>
    <section class="hero is-primary is-bold">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">Ingreso Cirugía</h1>
        </div>
      </div>
    </section>
    <a href="https://docs.google.com/presentation/d/1CIDeB-Nt_-2H8HYwG8AXPRVA8Xr3nPpWI_0aLWt4hRs/edit?usp=sharing">Click aquí para ir al slides</a>
    <form id="form" class="container m-4 pl-4 " method="POST">
    
    <div id="datos" class="columns has-background-grey-lighter">
        <div id="datos_personales" class="column">
    
          
            <div class="field">
            <label class="label">Nombre</label>
            <div class="control">
                <input
                class="input"
                placeholder="Ingrese nombre"
                name="nombre"
                />
            </div>
            </div>
            
            <div class="field">
            <label class="label">Rut</label>
            <div class="control">
                <input
                class="input"
                    placeholder="Ingrese rut"
                    name="rut"
                />
                </div>
            </div>
    
            <div class="field">
                <label class="label">Edad</label>
                <div class="control">
                <input
                    class="input"
                    type="number"
                    placeholder="Ingrese edad"
                    name="edad"
                    />
                </div>
            </div>
            
            <div class="field">
                <label class="label">Fecha</label>
                <div class="control">
                <input
                class="input"
                type="date"
                placeholder="Ingrese fecha"
                name="fecha"
                />
                </div>
            </div>
    
            <div class="field">
                <label class="label">Hora</label>
                <div class="control">
                <input
                class="input"
                type="time"
                placeholder="Ingrese hora"
                name="hora"
                />
                </div>
            </div>
            
            <div class="field">
                <label class="label">Cama</label>
                <div class="control">
                <input
                class="input"
                placeholder="Ingrese cama"
                name="cama"
                />
                </div>
            </div>
            
            <div class="field">
                <label class="label">Procedencia</label>
                <div class="control">
                <input
                class="input"
                placeholder="Ingrese procedencia"
                name="procedencia"
                />
                </div>
            </div>
            
            <div class="field">
                <label class="label">Equipo</label>
                <div class="control">
                <input
                class="input"
                placeholder="Ingrese equipo"
                name="equipo"
                />
                </div>
            </div>
    
          
        </div>
        
        <div id="datos_antecedentes" class="column">
    
          <div class="field">
            <label class="label">Antecedentes Médicos</label>
            <div class="control">
              <textarea
                class="input"
                placeholder="Ingrese antecedentes médicos"
                name="antecedentes_medicos"
              ></textarea>
            </div>
          </div>
    
          <div class="field">
            <label class="label">Antecedentes Quirúrgicos</label>
            <div class="control">
              <textarea
                class="input"
                placeholder="Ingrese antecedentes quirúrgicos"
                name="antecedentes_quirurgicos"
              ></textarea>
            </div>
          </div>
    
          <div class="field">
            <label class="label">Medicamentos</label>
            <div class="control">
              <textarea
                class="input"
                placeholder="Ingrese medicamentos"
                name="medicamentos"
              ></textarea>
            </div>
          </div>
    
    
    
          <div class="field">
            <label class="label">Alergias</label>
            <div class="control">
              <input
                class="input"
                placeholder="Ingrese alergias"
                name="alergias"
                value="(-)"
              />
            </div>
          </div>
    
          <div class="field">
            <label class="label">Tabaquismo</label>
            <div class="control">
              <input
                class="input"
                placeholder="Ingrese tabaquismo"
                name="tbq"
                value="(-)"
              />
            </div>
          </div>
    
          <div class="field">
            <label class="label">Alcoholismo</label>
            <div class="control">
              <input
                class="input"
                placeholder="Ingrese alcoholismo"
                name="oh"
                value="(-)"
              />
            </div>
          </div>
    
        </div>

    </div>

    <div id="actual" class="columns has-background-warning">
        <div id="clinica" class="column">
            
          <div class="field">
            <label class="label">Motivo Consulta</label>
            <div class="control">
              <input
                class="input"
                placeholder="Ingrese motivo consulta"
                name="motivo_consulta"
              />
            </div>
          </div>
    
          <div class="field">
            <label class="label">Anamnesis</label>
            <div class="control">
              <textarea
                class="input"
                placeholder="Ingrese anamnesis"
                name="historia"
              ></textarea>
            </div>
          </div>
    
          <div class="field">
            <label class="label">Glasgow</label>
            <div class="control">
              <input
                class="input"
                type="number"
                placeholder="Ingrese glasgow"
                name="glasgow"
              />
            </div>
          </div>
          <div class="field">
            <label class="label">Piel</label>
            <div class="control">
              <input
                class="input"
                placeholder="Ingrese piel"
                name="piel"
                value="hidratada, llene capilar <2s, bien perfundida a distal"
              />
                </div>
            </div>
    
            <div id="signos_vitales" class="columns">
              <div class="field" style="padding-left: 20px; padding-right: 20px;">
                <label class="label">Temperatura</label>
                <div class="control">
                  <input
                    class="input"
                    type="number"
                    placeholder="Ingrese temperatura"
                    name="temp"
                    step="0.1"
                  />
                </div>
              </div>

              <div class="field" style="padding-left: 20px; padding-right: 20px;">
                <label class="label">PA</label>
                <div class="control">
                  <input
                    class="input"
                    placeholder="Ingrese presión arterial"
                    name="pa"
                  />
                </div>
              </div>
        
              <div class="field" style="padding-left: 20px; padding-right: 20px;">
                <label class="label">FC</label>
                <div class="control">
                  <input
                    class="input"
                    type="number"
                    placeholder="Ingrese frecuencia cardíaca"
                    name="fc"
                  />
                </div>
              </div>
        
              <div class="field" style="padding-left: 20px; padding-right: 20px;">
                <label class="label">Sat</label>
                <div class="control">
                  <input
                    class="input"
                    type="number"
                    placeholder="Ingrese saturación"
                    name="sat"
                  />
                </div>
              </div>
        
              <div class="field" style="padding-left: 20px; padding-right: 20px;">
                <label class="label">FR</label>
                <div class="control">
                  <input
                    class="input"
                    type="number"
                    placeholder="Ingrese frecuencia respiratoria"
                    name="fr"
                  />
                </div>
              </div>
          </div>
    
          <div class="field">
            <label class="label">Cabeza y cuello</label>
            <div class="control">
              <input
                class="input"
                placeholder="hallazgos cabeza y cuello"
                name="cyc"
                value="mucosas rosadas hidratadas, no palpo adenopatías"
              />
            </div>
          </div>
          <div id="torax" class="columns">

              <div class="field column">
                <label class="label">Cardiovascular</label>
                <div class="control">
                  <input
                    class="input"
                    name="cardio"
                    value="RR2T no ausculto soplos"
                  />
                </div>
              </div>
        
              <div class="field column">
                <label class="label">Pulmonar</label>
                <div class="control">
                  <input
                    class="input"
                    name="pulmonar"
                    value="MP(+) sin ruidos agregados"
                  />
                </div>
              </div>

          </div>
    
          <div class="field">
            <label class="label">Abdominal</label>
            <div class="control">
              <textarea
                class="input"
                placeholder="Ingrese abdominal"
                name="abdominal">RHA(+), depresible, indoloro. No palpo masas ni visceromegalias</textarea>
            </div>
          </div>
    
          <div class="field">
            <label class="label">Tacto Rectal</label>
            <div class="control">
                <input
                class="input"
                placeholder="Ingrese tacto rectal"
                name="tr"
                value="No se realiza">
    
            </div>
          </div>
    
          <div class="field">
            <label class="label">Extremidades</label>
            <div class="control">
              <input
                class="input"
                placeholder="Ingrese extremidades"
                name="extremidades"
              />
            </div>
          </div>
    
          <div class="field">
            <label class="label">Examen Físico Otros</label>
            <div class="control">
              <textarea
                class="input"
                placeholder="Ingrese examen físico otros"
                name="ef_otros"
              ></textarea>
            </div>
          </div>
    
        </div>    

    </div>
    
    


    <div></div>

    <div id="complementarios" class="columns has-background-primary">
        <div id="imagenes" class="column">
            <div class="field">
                <label class="label">TAC</label>
                <div class="control">
                  <textarea
                    class="input"
                    placeholder="Ingrese TAC"
                    name="tc"
                  ></textarea>
                </div>
              </div>
        
              <div class="field">
                <label class="label">Ecografía</label>
                <div class="control">
                  <textarea
                    class="input"
                    placeholder="Ingrese ecografía"
                    name="eco"
                  ></textarea>
                </div>
              </div>
        
              <div class="field">
                <label class="label">Otras imagenes</label>
                <div class="control">
                  <textarea
                    class="input"
                    placeholder="Ingrese otras imagenes"
                    name="img_otros"
                  ></textarea>
                </div>
              </div>
        
    
        </div>

        <div id="lab" class="column">
          <div class="field" style="height: 90%;">
              <label class="label">Laboratorio</label>
                <div class="columns">
                    <input type="url" id="pdfURL" class="input column" value="doc%20(2).pdf">    
                
                    <button id="openLab" type="button" class="button is-link " onclick="readLab()">Importar lab</button>
                </div>
              <div class="control" style="height: 90%;">
                <textarea
                  id="labText"
                  class="input"
                  name="lab"
                  style="height: 100%;"
                >
- Hemograma: 
- PCR: 
- Coagulación: 
- ELP/función renal: 
- Pruebas hepáticas/pancreáticas: 
- Otros: </textarea>
              </div>
            </div>
        </div>
    </div>



    <div id="analisis" class="columns has-background-success-dark">
        <div class="field column">
            <label class="label has-text-white">Diagnósticos</label>
            <div class="control">
              <textarea
                class="input"
                placeholder="Ingrese diagnósticos"
                name="dg"
              ></textarea>
            </div>
          </div>
    
          <div class="field column">
            <label class="label has-text-white">Plan</label>
            <div class="control">
              <textarea
                class="input"
                placeholder="Ingrese plan"
                name="plan"
              ></textarea>
            </div>
          </div>
    </div>

      

      <div class="field">
        <label class="label">Residente</label>
        <div class="control">
          <input
            class="input"
            placeholder="Ingrese residente"
            name="residente"
            value="Dr(a)."
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Becado</label>
        <div class="control">
          <input
            class="input"
            placeholder="Ingrese becado"
            name="becado"
            value="Dr(a)."
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Interno</label>
        <div class="control">
          <input
            class="input"
            placeholder="Ingrese interno"
            name="interno"
          />
        </div>
      </div>


      <div class="field is-grouped">
        <div class="control">
          <button class="button is-primary" type="submit" id="submit-button">
            Listo!!!
          </button>
        </div>
        <div>
          <button class="button is-danger" onclick="borrarDatos()">Borrar datos</button>
        </div>
      </div>
    </form>
    <div
      id="message"
      style="
        display: none;
        margin: 20px;
        font-weight: bold;
        color: green;
        padding: 8px;
        background-color: beige;
        border-radius: 4px;
        border-color: aquamarine;
      "
    ></div>

    <script>
      document.getElementById("form").addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent the default form submission
        document.getElementById("message").textContent = "Submitting..";
        document.getElementById("message").style.display = "block";
        document.getElementById("submit-button").disabled = true;
        console.log("Submitting the form..");
        // Collect the form data
        var formData = new FormData(this);
        var keyValuePairs = [];
        for (var pair of formData.entries()) {
          keyValuePairs.push(pair[0] + "=" + pair[1]);
        }
        console.log(keyValuePairs);
        var formDataString = keyValuePairs.join("&");
        console.log(formDataString + '\n justo antes del fetch');
        // Send a POST request to your Google Apps Script
        fetch(
          "https://script.google.com/macros/s/AKfycbza_5dm_2HHUBOTQwEGHKUZeQ21b-RLUKlAbUAvmiRGrZ_BbWx9TD9QASq56miHI1_0/exec",
          {
            redirect: "follow",
            method: "POST",
            body: formDataString,
            headers: {
              "Content-Type": "text/plain;charset=utf-8",
            },
          }
        )
          .then(function (response) {
            console.log("Success! estás dentro del POST request.");
            // Check if the request was successful
            if (response) {
              console.log("Response:", response);
              console.log(formDataString );
              return response; // Assuming your script returns JSON response
            } else {
              throw new Error("Failed to submit the form.");
            }
          })
          .then(function (data) {
            // Display a success message
            document.getElementById("message").textContent =
              "Data submitted successfully!";
            document.getElementById("message").style.display = "block";
            document.getElementById("message").style.backgroundColor = "green";
            document.getElementById("message").style.color = "beige";
            document.getElementById("submit-button").disabled = false;
            document.getElementById("form");
            // open slides link on new tab https://docs.google.com/presentation/d/1CIDeB-Nt_-2H8HYwG8AXPRVA8Xr3nPpWI_0aLWt4hRs/edit#slide=id.p
            window.open("https://docs.google.com/presentation/d/1CIDeB-Nt_-2H8HYwG8AXPRVA8Xr3nPpWI_0aLWt4hRs/edit#slide=id.SLIDES_API1924043185_0", "_blank");
            // var windowReference = window.open();
            // myService.getUrl().then(function(url) {
            //  url = "https://docs.google.com/presentation/d/1CIDeB-Nt_-2H8HYwG8AXPRVA8Xr3nPpWI_0aLWt4hRs/edit#slide=id.SLIDES_API1924043185_0";
            //  windowReference.location = url;

            // });

            setTimeout(function () {
              document.getElementById("message").textContent = "";
              document.getElementById("message").style.display = "none";
            }, 5000);
          })
          .catch(function (error) {
            // Handle errors, you can display an error message here
            console.error(error);
            document.getElementById("message").textContent =
              "An error occurred while submitting the form.";
            document.getElementById("message").style.display = "block";
            
          });
      });
      borrarDatos = () => {
        document.getElementById("form").reset();
      };
    </script>
  </body>
</html>
